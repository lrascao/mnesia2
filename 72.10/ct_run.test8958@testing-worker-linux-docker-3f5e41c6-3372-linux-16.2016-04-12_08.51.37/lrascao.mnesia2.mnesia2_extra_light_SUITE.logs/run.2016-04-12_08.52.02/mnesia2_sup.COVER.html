<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<title>/home/travis/build/lrascao/mnesia2/logs/ct_run.test8958@testing-worker-linux-docker-3f5e41c6-3372-linux-16.2016-04-12_08.51.37/lrascao.mnesia2.mnesia2_extra_light_SUITE.logs/run.2016-04-12_08.52.02/mnesia2_sup.COVER.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /home/travis/build/lrascao/mnesia2/ebin/mnesia2_sup.erl by COVER 2016-04-12 at 08:52:59

****************************************************************************

        |  %%
        |  %% %CopyrightBegin%
        |  %% 
        |  %% Copyright Ericsson AB 1996-2013. All Rights Reserved.
        |  %% 
        |  %% Licensed under the Apache License, Version 2.0 (the "License");
        |  %% you may not use this file except in compliance with the License.
        |  %% You may obtain a copy of the License at
        |  %%
        |  %%     http://www.apache.org/licenses/LICENSE-2.0
        |  %%
        |  %% Unless required by applicable law or agreed to in writing, software
        |  %% distributed under the License is distributed on an "AS IS" BASIS,
        |  %% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        |  %% See the License for the specific language governing permissions and
        |  %% limitations under the License.
        |  %% 
        |  %% %CopyrightEnd%
        |  %%
        |  
        |  %%
        |  %% Supervisor for the entire Mnesia2 application
        |  
        |  -module(mnesia2_sup).
        |  
        |  -behaviour(application).
        |  -behaviour(supervisor).
        |  
        |  -export([start/0, start/2, init/1, stop/1, start_event/0, kill/0]).
        |  
        |  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        |  %% application and suprvisor callback functions
        |  
        |  start(normal, Args) -&gt;
<font color=red>     0..|      SupName = {local,?MODULE},</font>
<font color=red>     0..|      case supervisor:start_link(SupName, ?MODULE, [Args]) of</font>
        |  	{ok, Pid} -&gt;
<font color=red>     0..|  	    {ok, Pid, {normal, Args}};</font>
        |  	Error -&gt; 
<font color=red>     0..|  	    Error</font>
        |      end;
        |  start(_, _) -&gt;
<font color=red>     0..|      {error, badarg}.</font>
        |  
        |  start() -&gt;
<font color=red>     0..|      SupName = {local,?MODULE},</font>
<font color=red>     0..|      supervisor:start_link(SupName, ?MODULE, []).</font>
        |  
        |  stop(_StartArgs) -&gt;
<font color=red>     0..|      ok.</font>
        |  
        |  init([]) -&gt; % Supervisor
<font color=red>     0..|      init();</font>
        |  init([[]]) -&gt; % Application
<font color=red>     0..|      init();</font>
        |  init(BadArg) -&gt;
<font color=red>     0..|      {error, {badarg, BadArg}}.</font>
        |      
        |  init() -&gt;
<font color=red>     0..|      ok = mnesia2_tab:init(),</font>
<font color=red>     0..|      Flags = {one_for_all, 0, 3600}, % Should be rest_for_one policy</font>
        |  
<font color=red>     0..|      Event = event_procs(),</font>
<font color=red>     0..|      Kernel = kernel_procs(),</font>
        |  
<font color=red>     0..|      {ok, {Flags, Event ++ Kernel}}.</font>
        |  
        |  event_procs() -&gt;
<font color=red>     0..|      KillAfter = timer:seconds(30),</font>
<font color=red>     0..|      KA = mnesia2_kernel_sup:supervisor_timeout(KillAfter),</font>
<font color=red>     0..|      E = mnesia2_event,</font>
<font color=red>     0..|      [{E, {?MODULE, start_event, []}, permanent, KA, worker, [E, gen_event]}].</font>
        |  
        |  kernel_procs() -&gt;
<font color=red>     0..|      K = mnesia2_kernel_sup,</font>
<font color=red>     0..|      KA = infinity,</font>
<font color=red>     0..|      [{K, {K, start, []}, permanent, KA, supervisor, [K, supervisor]}].</font>
        |  
        |  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        |  %% event handler
        |  
        |  start_event() -&gt;
<font color=red>     0..|      case gen_event:start_link({local, mnesia2_event}) of</font>
        |  	{ok, Pid} -&gt;
<font color=red>     0..|  	    case add_event_handler() of</font>
        |  		ok -&gt; 
<font color=red>     0..|  		    {ok, Pid};</font>
        |  		Error -&gt;
<font color=red>     0..|  		    Error</font>
        |  	    end;
        |  	Error  -&gt;
<font color=red>     0..|  	    Error</font>
        |      end.
        |  
        |  add_event_handler() -&gt;
<font color=red>     0..|      Handler = mnesia2_monitor:get_env(event_module),</font>
<font color=red>     0..|      gen_event:add_handler(mnesia2_event, Handler, []).</font>
        |      
        |  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        |  %% debug functions
        |  
        |  kill() -&gt;
    96..|      Mnesia2 = [mnesia2_fallback | mnesia2:ms()],
    96..|      Kill = fun(Name) -&gt; catch exit(whereis(Name), kill) end,
    96..|      lists:foreach(Kill, Mnesia2),
    96..|      lists:foreach(fun ensure_dead/1, Mnesia2),
    96..|      timer:sleep(10),
    96..|      case lists:keymember(mnesia2, 1, application:which_applications()) of
<font color=red>     0..|  	true -&gt; kill();</font>
    96..|  	false -&gt; ok
        |      end.
        |  
        |  ensure_dead(Name) -&gt;
  2784..|      case whereis(Name) of
        |  	undefined -&gt;
  2784..|  	    ok;
        |  	Pid when is_pid(Pid) -&gt;
<font color=red>     0..|  	    exit(Pid, kill),</font>
<font color=red>     0..|  	    timer:sleep(10),</font>
<font color=red>     0..|  	    ensure_dead(Name)</font>
        |      end.
        |  
</pre>
</body>
</html>
