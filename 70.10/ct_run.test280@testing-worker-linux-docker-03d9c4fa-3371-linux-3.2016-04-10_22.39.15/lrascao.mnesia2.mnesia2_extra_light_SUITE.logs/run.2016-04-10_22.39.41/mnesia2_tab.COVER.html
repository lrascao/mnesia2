<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<title>/home/travis/build/lrascao/mnesia2/logs/ct_run.test280@testing-worker-linux-docker-03d9c4fa-3371-linux-3.2016-04-10_22.39.15/lrascao.mnesia2.mnesia2_extra_light_SUITE.logs/run.2016-04-10_22.39.41/mnesia2_tab.COVER.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /home/travis/build/lrascao/mnesia2/ebin/mnesia2_tab.erl by COVER 2016-04-10 at 22:40:37

****************************************************************************

        |  %%
        |  %% %CopyrightBegin%
        |  %%
        |  %% Copyright Ericsson AB 1996-2016. All Rights Reserved.
        |  %%
        |  %% Licensed under the Apache License, Version 2.0 (the "License");
        |  %% you may not use this file except in compliance with the License.
        |  %% You may obtain a copy of the License at
        |  %%
        |  %%     http://www.apache.org/licenses/LICENSE-2.0
        |  %%
        |  %% Unless required by applicable law or agreed to in writing, software
        |  %% distributed under the License is distributed on an "AS IS" BASIS,
        |  %% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        |  %% See the License for the specific language governing permissions and
        |  %% limitations under the License.
        |  %%
        |  %% %CopyrightEnd%
        |  %%
        |  
        |  %%
        |  -module(mnesia2_tab).
        |  
        |  -export([init/0,
        |           stop/0,
        |           new/1,
        |           is_blocked/1,
        |           block/1, unblock/1]).
        |  
        |  -define(BLOCKED_TABS_TABLE, ?MODULE).
        |  
        |  -spec init() -&gt; ok.
        |  init() -&gt;
<font color=red>     0..|      ?BLOCKED_TABS_TABLE =</font>
        |          ets:new(?BLOCKED_TABS_TABLE, [set, named_table,
        |                                        public,
        |                                        {write_concurrency, true},
        |                                        {read_concurrency, true}]),
<font color=red>     0..|      ok.</font>
        |  
        |  -spec stop() -&gt; ok.
        |  stop() -&gt;
<font color=red>     0..|      true = ets:delete(?BLOCKED_TABS_TABLE),</font>
<font color=red>     0..|      ok.</font>
        |  
        |  -spec new(Tab :: atom()) -&gt; ok.
        |  new(Tab) -&gt;
<font color=red>     0..|      true = ets:insert_new(?BLOCKED_TABS_TABLE, {Tab, 0}),</font>
<font color=red>     0..|      ok.</font>
        |  
        |  -spec is_blocked(Tab :: atom()) -&gt; boolean().
        |  is_blocked(Tab) -&gt;
<font color=red>     0..|      case ets:lookup(?BLOCKED_TABS_TABLE, Tab) of</font>
<font color=red>     0..|          [] -&gt; false;</font>
<font color=red>     0..|          [{Tab, 0}] -&gt; false;</font>
<font color=red>     0..|          [{Tab, N}] when N &gt; 0 -&gt; true</font>
        |      end.
        |  
        |  -spec block(Tab :: atom()) -&gt; integer().
        |  block(Tab) -&gt;
        |      %% make sure the table exists
<font color=red>     0..|      ok = case ets:lookup(?BLOCKED_TABS_TABLE, Tab) of</font>
<font color=red>     0..|              [] -&gt; new(Tab);</font>
<font color=red>     0..|              _ -&gt; ok</font>
        |           end,
        |      %% bump the counter (which is the second element in the tuple)
        |      %% by 1
<font color=red>     0..|      ets:update_counter(?BLOCKED_TABS_TABLE,</font>
        |                         Tab, {2, 1}).
        |  
        |  -spec unblock(Tab :: atom()) -&gt; integer().
        |  unblock(Tab) -&gt;
        |      %% decrease the counter (which is the second element in the tuple)
        |      %% by 1, make sure it doesn't fall below 0
<font color=red>     0..|      ets:update_counter(?BLOCKED_TABS_TABLE,</font>
        |                         Tab, {2, -1, 0, 0}).
</pre>
</body>
</html>
